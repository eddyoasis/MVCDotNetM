@model PaginatedList<MarginCallViewModel>

@{
    ViewBag.Title = "Manage Margin Call(EOD)";
    int currentPageSize = ViewData["CurrentPageSize"] as int? ?? Model.PageSize;
    int isMaginModeAll = (int)ViewData["isMaginModeAll"];
}

@if (Model != null && Model.Any())
{
    <div class="table-responsive">
        <table id="myDataTable" class="table table-striped table-bordered table-hover">
            <thead>
                <tr>
                    <th>PortfolioID</th>
                    <th>Percentages</th>
                    <th>MarginCallAmount</th>
                    <th>Day</th>
                    <th>Collateral</th>
                    <th>Collateral_Ccy</th>
                    <th>VM</th>
                    <th>VM_Ccy</th>
                    <th>IM</th>
                    <th>IM_Ccy</th>
                    <th>MarginCall</th>
                    <th>Stoploss</th>
                    <th>MOC</th>
                    <th>Detail</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>@item.PortfolioID</td>
                        <td>@item.Percentages</td>
                        <td>@item.MarginCallAmount</td>
                        <td>@item.Day</td>
                        <td>@item.Collateral</td>
                        <td>@item.Collateral_Ccy</td>
                        <td>@item.VM</td>
                        <td>@item.VM_Ccy</td>
                        <td>@item.IM</td>
                        <td>@item.IM_Ccy</td>
                        <td>
                            <div class="d-flex flex-wrap gap-1">
                                @if (isMaginModeAll == 1)
                                {
                                    <button style="width:170px;" class="btn btn-sm btn-success btn-approve" data-id="@item.PortfolioID" disabled="@item.MarginCallTriggerFlag">Margin</button>
                                    @(item.MarginCallTriggerFlag == true ? $"{item.MarginCallTriggerDatetime}" : "")

                                }
                            </div>
                        </td>
                        <td>
                            <div class="d-flex flex-wrap gap-1">
                                @if (isMaginModeAll == 1)
                                {
                                    @if (item.Day != "1")
                                    {
                                        <button style="width:170px;" class="btn btn-sm btn-success btn-approveStoploss" data-id="@item.PortfolioID" disabled="@item.StoplossTriggerFlag">StopLoss</button>
                                        @(item.StoplossTriggerFlag == true ? $"{item.StoplossTriggerDatetime}" : "")

                                    }
                                }
                            </div>
                        </td>
                        <td>
                            @if (isMaginModeAll == 1)
                            {
                                @if (item.Day == "3")
                                {
                                    <button style="width:170px;" class="btn btn-sm btn-success btn-approveMOC" data-id="@item.PortfolioID" disabled="@item.MOCTriggerFlag">MOC</button>
                                    @(item.MOCTriggerFlag == true ? $"{item.MOCTriggerDatetime}" : "")

                                }
                            }
                        </td>
                        <td>
                            <button class="btn btn-sm btn-info btn-detail" data-id="@item.PortfolioID">Details</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        <!-- Pagination Links -->
        <ul>
            <li>
                Total Pages: <input style="width: 70px;" type="number" id="pageIndexNew" value="@Model.PageIndex" />/@Model.TotalPages
                <button id="btnGo" class="btn btn-sm btn-warning">Go</button>
                @if (Model.HasPreviousPage)
                {
                    <button id="btnPrevious" class="btn btn-sm btn-primary">Previous</button>
                }
                @if (Model.HasNextPage)
                {
                    <button id="btnNext" class="btn btn-sm btn-primary">Next</button>
                }
            </li>
            <li>Total Items: @Model.TotalItems</li>
        </ul>
    </div>
}
else
{
    <div class="alert alert-info">
        <strong>No Items Found</strong>
        <p>There are no items to display.</p>
    </div>
}

<!-- Approve Modal Container -->
<div class="modal fade" id="approveModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
        </div>
    </div>
</div>

<!-- Reject Modal Container -->
<div class="modal fade" id="rejectModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
        </div>
    </div>
</div>

<!-- Edit Modal Container -->
<div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
        </div>
    </div>
</div>

<!-- Detail Modal Container -->
<div class="modal fade" id="detailModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
        </div>
    </div>
</div>

<!-- Delete Modal Container -->
<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
        </div>
    </div>
</div>


@* Include DataTables CSS and JS (CDN) *@
@section scripts {
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs5/dt-1.13.8/datatables.min.css" />
    <script type="text/javascript" src="https://cdn.datatables.net/v/bs5/dt-1.13.8/datatables.min.js"></script>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- jQuery Validation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/additional-methods.min.js"></script>

    <script>
        $(document).ready(function () {

            /*========================================== DataTable*/
            var table = $('#myDataTable').DataTable({
                "columns": [
                    { "data": "CcyCode" },
                    { "data": "ClientCode" },
                    { "data": "IM" },
                    { "data": "LedgerBal" },
                    { "data": "OrderDetails" },
                    { "data": "Percentages" },
                    { "data": "Status" },
                    { "data": "TimeStemp" },
                    { "data": "TNE" },
                    { "data": "TypeOfMarginCall" },
                    { "data": "actionString" },
                ],
                "ordering": true, // Enable sorting
                "searching": true,  // Enable searching
                "language": {
                    "emptyTable": "No data available in table",
                    "info": "Showing _START_ to _END_ of _TOTAL_ entries",
                    "infoEmpty": "Showing 0 to 0 of 0 entries",
                    "infoFiltered": "(filtered from _MAX_ total entries)",
                    "infoPostFix": "",
                    "thousands": ",",
                    "loadingRecords": "Loading...",
                    "processing": "Processing...",
                    "search": "Search:",
                    "zeroRecords": "No matching records found",
                    "aria": {
                        "sortAscending": ": activate to sort column ascending",
                        "sortDescending": ": activate to sort column descending"
                    },
                    "select": {
                        "rows": {
                            "_": "Selected %d rows",
                            "0": "Click a row to select it",
                            "1": "Selected 1 row"
                        }
                    }
                }
            });
        });
    </script>
}

