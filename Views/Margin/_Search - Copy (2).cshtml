@* @model IEnumerable<MarginViewModel> *@
@model MVCWebApp.Helper.PaginatedList<MarginViewModel>

@{
    ViewBag.Title = "Manage Margins";
    int currentPageSize = ViewData["CurrentPageSize"] as int? ?? Model.PageSize;
}

<div class="container">
    @*     <h2>@ViewBag.Title</h2>

    <p>
    Username: @ViewBag.Username
    Email: @ViewBag.Email
    </p>

    <p>
    <button type="button" class="btn btn-primary" id="btnCreate">Create</button>
    @Html.ActionLink("Sign out", "Logout")
    </p> *@

    <button type="button" class="btn btn-primary" id="btnCreate">Create</button>

    <form asp-action="Index" method="get" class="form-inline mb-3">
        <label for="pageSize" class="mr-2">Items per page:</label>
        <select id="pageSize" name="pageSize" class="form-control" onchange="this.form.submit()">
            @if (currentPageSize == 5)
            {
                <option value="5" selected>5</option>
            }
            else
            {
                <option value="5">5</option>
            }

            @if (currentPageSize == 10)
            {
                <option value="10" selected>10</option>
            }
            else
            {
                <option value="10">10</option>
            }

            @if (currentPageSize == 20)
            {
                <option value="20" selected>20</option>
            }
            else
            {
                <option value="20">20</option>
            }

            @if (currentPageSize == 50)
            {
                <option value="50" selected>50</option>
            }
            else
            {
                <option value="50">50</option>
            }
        </select>
        @* <input type="hidden" name="pageNumber" value="1" /> *@
        <input type="hidden" id="pageIndex" value="@Model.PageIndex" />
    </form>

    <ul>
        <li>Total Pages: @Model.TotalPages</li>
        <li>Items Per Page: @Model.PageSize</li>
    </ul>

    @if (Model != null && Model.Any())
    {
        <div class="table-responsive">
            <table id="myDataTable" class="table table-striped table-bordered table-hover">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Username</th>
                        <th>Percentage</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>@item.ID</td>
                            <td>@item.Username</td>
                            <td>@item.Percentage%</td>
                            <td class="text-right">
                                <button class="btn btn-sm btn-warning btn-edit" data-id="@item.ID">Edit</button>
                                <button class="btn btn-sm btn-info btn-detail" data-id="@item.ID">Details</button>
                                <button class="btn btn-sm btn-danger btn-delete" data-id="@item.ID">Delete</button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>

            <!-- Pagination Links -->
            <div class="d-flex justify-content-between">
                @if (Model.HasPreviousPage)
                {
                    <a asp-action="Index"
                       asp-route-pageNumber="@(Model.PageIndex - 1)"
                       asp-route-pageSize="@Model.PageSize"
                       class="btn btn-primary">Previous</a>
                }
                <span>Current Page: @Model.PageIndex</span>
                @if (Model.HasNextPage)
                {
                    <button id="btnNext" class="btn btn-primary btnNext">Next</button>
                    @*           <a asp-action="Index"
            asp-route-pageNumber="@(Model.PageIndex + 1)"
            asp-route-pageSize="@Model.PageSize"
            class="btn btn-primary">Next</a> *@
                }
            </div>
        </div>
    }
    else
    {
        <div class="alert alert-info">
            <strong>No Items Found</strong>
            <p>There are no items to display.</p>
        </div>
    }


    <!-- Modal Container -->
    <div class="modal fade" id="createModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <!-- The create form will be loaded here via AJAX -->
            </div>
        </div>
    </div>

    <!-- Edit Modal Container -->
    <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <!-- The edit form partial view will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Detail Modal Container -->
    <div class="modal fade" id="detailModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <!-- The detail form partial view will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Delete Modal Container -->
    <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <!-- The delete form partial view will be loaded here -->
            </div>
        </div>
    </div>
</div>

@* Include DataTables CSS and JS (CDN) *@
@section scripts {
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs5/dt-1.13.8/datatables.min.css" />
    <script type="text/javascript" src="https://cdn.datatables.net/v/bs5/dt-1.13.8/datatables.min.js"></script>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- jQuery Validation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/additional-methods.min.js"></script>

    <script>
        $(document).ready(function () {

            /*========================================== DataTable*/
            var table = $('#myDataTable').DataTable({
                "columns": [
                    { "data": "id" },
                    { "data": "username" },
                    { "data": "percentage" },
                    { "data": "actionString" },
                    //{}
                ],
                // Enable features
                // "paging": true,   // Enable pagination
                "ordering": true, // Enable sorting
                "searching": true,  // Enable searching
                // "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]], // Customize page length options
                // "pageLength": 2, // Default page length
                // Optionally, customize the text:
                "language": {
                    "emptyTable": "No data available in table",
                    "info": "Showing _START_ to _END_ of _TOTAL_ entries",
                    "infoEmpty": "Showing 0 to 0 of 0 entries",
                    "infoFiltered": "(filtered from _MAX_ total entries)",
                    "infoPostFix": "",
                    "thousands": ",",
                    // "lengthMenu": "Show _MENU_ entries",
                    "loadingRecords": "Loading...",
                    "processing": "Processing...",
                    "search": "Search:",
                    "zeroRecords": "No matching records found",
                    // "paginate": {
                    //     "first": "First",
                    //     "last": "Last",
                    //     "next": "Next",
                    //     "previous": "Previous"
                    // },
                    "aria": {
                        "sortAscending": ": activate to sort column ascending",
                        "sortDescending": ": activate to sort column descending"
                    },
                    "select": {
                        "rows": {
                            "_": "Selected %d rows",
                            "0": "Click a row to select it",
                            "1": "Selected 1 row"
                        }
                    }
                }
            });
        });
    </script>
}

